<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  background:#111;
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:360px;
  background:#1e1e1e;
  padding:12px;
  border-radius:10px;
}
input,button{
  width:100%;
  padding:8px;
  margin-top:6px;
  border:none;
  border-radius:5px;
}
button{
  background:#00b894;
  font-weight:bold;
}
#messages{
  height:280px;
  overflow-y:auto;
  border:1px solid #333;
  padding:5px;
  margin-bottom:5px;
}
.msg{margin-bottom:4px}
.name{color:#00cec9;font-weight:bold}
.hidden{display:none}
</style>
</head>

<body>

<!-- ğŸ” ØªØ³Ø¬ÙŠÙ„ -->
<div class="box" id="loginBox">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
  <input id="username" placeholder="Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø± (ØºÙŠØ± Ù…ÙƒØ±Ø±)">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
  <p id="loginMsg"></p>
</div>

<!-- ğŸ’¬ Ø§Ù„Ø´Ø§Øª -->
<div class="box hidden" id="chatBox">
  <div id="messages"></div>
  <input id="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
  <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
// ğŸ”¹ Firebase config
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const chatRef = db.ref("publicChat/messages");

let currentName = "";

// ğŸ” ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„
function login(){
  const u = username.value.trim();
  const p = password.value.trim();
  if(!u || !p) return;

  const email = u + "@chat.app";

  auth.createUserWithEmailAndPassword(email,p)
  .then(()=>startChat(u))
  .catch(err=>{
    if(err.code==="auth/email-already-in-use"){
      auth.signInWithEmailAndPassword(email,p)
      .then(()=>startChat(u))
      .catch(()=>loginMsg.innerText="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£");
    }else{
      loginMsg.innerText="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
    }
  });
}

// â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø´Ø§Øª
function startChat(name){
  currentName = name;
  loginBox.classList.add("hidden");
  chatBox.classList.remove("hidden");
  loadMessages();
}

// ğŸ“© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function loadMessages(){
  chatRef.limitToLast(100).on("child_added", snap=>{
    const m = snap.val();
    const d = document.createElement("div");
    d.className="msg";
    d.innerHTML=`<span class="name">${m.name}:</span> ${m.text}`;
    messages.appendChild(d);
    messages.scrollTop=999999;
  });
}

// âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„
function send(){
  const t = text.value.trim();
  if(!t) return;
  chatRef.push({
    name: currentName,
    text: t,
    time: Date.now()
  });
  text.value="";
}
</script>

</body>
</html>